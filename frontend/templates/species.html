<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‰©ç§ç®¡ç† - ç”Ÿç‰©å¤šæ ·æ€§ç›‘æµ‹ç³»ç»Ÿ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <style>
        /* ========== å…¨å±€å˜é‡ï¼ˆåŒæ­¥index.htmlçš„åŒ—æ—é…è‰²ï¼‰ ========== */
        :root {
            --bjfu-primary: #0A5E38;        /* åŒ—æ—æ·±ç»¿ - ä¸»è‰²è°ƒï¼ˆåŒæ­¥index.htmlçš„--bfu-green-darkï¼‰ */
            --bjfu-secondary: #147D4C;      /* åŒ—æ—hoverç»¿ - è¾…åŠ©è‰²ï¼ˆåŒæ­¥index.htmlçš„--bfu-green-hoverï¼‰ */
            --bjfu-light: #E6F4EA;          /* æµ…ç»¿èƒŒæ™¯ï¼ˆåŒæ­¥index.htmlçš„--bfu-green-lightï¼‰ */
            --bjfu-accent: #FFC107;         /* é‡‘è‰²ç‚¹ç¼€ï¼ˆä¿ç•™åŸæœ‰ï¼‰ */
            --bjfu-dark: #0A5E38;           /* æ·±ç»¿ï¼ˆä¸ä¸»è‰²è°ƒä¸€è‡´ï¼‰ */
            --bjfu-text: #333333;           /* ä¸»è¦æ–‡å­—è‰²ï¼ˆåŒæ­¥index.htmlçš„--bfu-textï¼‰ */
            --bjfu-text-light: #666666;     /* æ¬¡è¦æ–‡å­—è‰² */
            --bjfu-border: #B3E0C2;         /* è¾¹æ¡†è‰²ï¼ˆåŸºäºæµ…ç»¿è°ƒæ•´ï¼‰ */
            --bjfu-shadow: rgba(10, 94, 56, 0.1); /* é˜´å½±ï¼ˆåŸºäºä¸»è‰²è°ƒï¼‰ */
            --bjfu-gradient: linear-gradient(135deg, #0A5E38 0%, #147D4C 100%); /* æ¸å˜ï¼ˆä¸»è‰²åˆ°hoverè‰²ï¼‰ */
        }

        /* ========== å…¨å±€æ ·å¼é‡ç½® ========== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans SC', 'Microsoft YaHei', 'Segoe UI', sans-serif; /* ä¼˜å…ˆä½¿ç”¨index.htmlçš„å­—ä½“ */
            background-color: #F5F7F6; /* åŒæ­¥index.htmlçš„--bfu-gray */
            color: var(--bjfu-text);
            line-height: 1.6;
            margin: 0;
            padding: 0;
        }

        /* ========== å¯¼èˆªæ æ ·å¼ ========== */
        .navbar {
            background: var(--bjfu-gradient) !important;
            box-shadow: 0 4px 12px var(--bjfu-shadow);
            padding: 0.8rem 0;
            border-bottom: 3px solid var(--bjfu-accent);
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1030;
        }

        .navbar-brand {
            font-weight: 700;
            font-size: 1.5rem;
            background: linear-gradient(to right, #FFFFFF 0%, #FFD700 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            position: relative;
            padding-left: 45px;
        }

        .navbar-brand::before {
            content: "ğŸŒ³";
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.8rem;
        }

        .navbar-nav .nav-link {
            color: rgba(255, 255, 255, 0.9) !important;
            font-weight: 500;
            padding: 0.5rem 1.2rem;
            margin: 0 0.2rem;
            border-radius: 4px;
            transition: all 0.3s ease;
            position: relative;
        }

        .navbar-nav .nav-link:hover {
            color: white !important;
            background-color: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }

        .navbar-nav .nav-link.active {
            background-color: rgba(255, 255, 255, 0.25);
            color: white !important;
        }

        /* ========== ä¾§è¾¹æ è°ƒæ•´ ========== */
        .sidebar {
            background-color: #fff;
            border-right: 1px solid var(--bjfu-border);
            height: 100vh;
            position: fixed;
            top: 56px;
            left: 0;
            width: 220px;
            padding-top: 20px;
            box-shadow: 2px 0 8px var(--bjfu-shadow);
            z-index: 100;
        }

        .sidebar-header {
            padding: 0 20px 20px;
            border-bottom: 1px solid var(--bjfu-border);
            margin-bottom: 20px;
        }

        .sidebar-header h4 {
            font-weight: 600;
            color: var(--bjfu-primary);
        }

        .sidebar-menu {
            list-style: none;
            padding: 0 20px;
            margin: 0;
        }

        .sidebar-menu li {
            margin-bottom: 8px;
        }

        .sidebar-menu a {
            color: var(--bjfu-text);
            text-decoration: none;
            display: block;
            padding: 12px 15px;
            border-radius: 5px;
            transition: all 0.3s ease;
        }

        .sidebar-menu a:hover, .sidebar-menu a.active {
            background-color: var(--bjfu-primary);
            color: white;
        }

        .sidebar-menu a i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }

        /* ========== ä¸»å†…å®¹åŒºè°ƒæ•´ ========== */
        .main-content {
            margin-left: 220px;
            margin-top: 56px;
            padding: 30px;
        }

        .page-header {
            margin-bottom: 30px;
        }

        .page-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--bjfu-dark);
            position: relative;
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
        }

        .page-title::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            width: 60px;
            height: 4px;
            background: var(--bjfu-gradient);
            border-radius: 2px;
        }

        .breadcrumb {
            background: transparent;
            padding: 0;
            margin-bottom: 10px;
        }

        .breadcrumb-item a {
            color: var(--bjfu-primary);
            text-decoration: none;
        }

        /* ========== å¡ç‰‡æ ·å¼ ========== */
        .content-card {
            background: white;
            border: 2px solid transparent;
            border-radius: 12px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            padding: 20px;
            margin-bottom: 1.5rem;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .content-card:hover {
            transform: translateY(-8px);
            border-color: var(--bjfu-primary);
            box-shadow: 0 8px 20px rgba(10, 94, 56, 0.15);
        }

        .card {
            border: 2px solid transparent;
            border-radius: 12px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            margin-bottom: 1.5rem;
            overflow: hidden;
            transition: all 0.3s ease;
            background: white;
        }

        .card:hover {
            transform: translateY(-8px);
            border-color: var(--bjfu-primary);
            box-shadow: 0 8px 20px rgba(10, 94, 56, 0.15);
        }

        .card-header-park {
            background: var(--bjfu-gradient) !important;
            color: white;
            padding: 1rem 1.5rem;
            font-weight: 600;
            font-size: 1.1rem;
            border-bottom: none;
            position: relative;
            overflow: hidden;
            border-radius: 5px 5px 0 0;
        }

        .card-header-park::after {
            content: "";
            position: absolute;
            top: 0;
            right: 0;
            width: 60px;
            height: 100%;
            background: rgba(255, 255, 255, 0.1);
            transform: skewX(-15deg);
        }

        .card-body {
            padding: 1.5rem;
            position: relative;
            z-index: 1;
        }

        /* ========== æŒ‰é’®æ ·å¼ ========== */
        .btn-park {
            background: var(--bjfu-gradient);
            border: none;
            color: white;
            font-weight: 600;
            padding: 0.6rem 1.5rem;
            border-radius: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(10, 94, 56, 0.2);
            position: relative;
            overflow: hidden;
        }

        .btn-park::before {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s ease;
        }

        .btn-park:hover {
            background: linear-gradient(135deg, #147D4C 0%, #0A5E38 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(10, 94, 56, 0.3);
        }

        .btn-park:hover::before {
            left: 100%;
        }

        .btn-park:active {
            transform: translateY(0);
            box-shadow: 0 2px 5px rgba(10, 94, 56, 0.2);
        }

        .btn-outline-primary {
            border-color: var(--bjfu-primary);
            color: var(--bjfu-primary);
        }

        .btn-outline-primary:hover {
            background-color: var(--bjfu-primary);
            border-color: var(--bjfu-primary);
        }

        .btn-outline-danger {
            border-color: #dc3545;
            color: #dc3545;
        }

        .btn-outline-danger:hover {
            background-color: #dc3545;
            border-color: #dc3545;
        }

        /* ========== è¡¨æ ¼æ ·å¼ ========== */
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th {
            background: var(--bjfu-gradient);
            color: white;
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            border: none;
        }

        .data-table td {
            padding: 12px 15px;
            border-bottom: 1px solid var(--bjfu-border);
            border-left: 1px solid var(--bjfu-border);
            border-right: 1px solid var(--bjfu-border);
        }

        .data-table tr:hover {
            background-color: var(--bjfu-light);
            transform: scale(1.002);
            transition: all 0.2s ease;
        }

        /* ========== å¾½ç« æ ·å¼è°ƒæ•´ ========== */
        .badge {
            padding: 0.4em 0.8em;
            font-weight: 600;
            border-radius: 20px;
            font-size: 0.85em;
        }

        .badge-danger-custom {
            background-color: #dc3545 !important;
        }

        .badge-warning-custom {
            background-color: var(--bjfu-accent) !important;
            color: #333;
        }

        .badge-success-custom {
            background-color: var(--bjfu-primary) !important;
        }

        /* ========== åˆ†é¡µè°ƒæ•´ ========== */
        .pagination-custom {
            justify-content: end;
            margin-top: 20px;
        }

        .pagination-custom .page-link {
            color: var(--bjfu-text);
            border-radius: 8px !important;
            margin: 0 4px;
            border: 1px solid var(--bjfu-border);
            transition: all 0.3s ease;
        }

        .pagination-custom .page-link:hover {
            color: white;
            background-color: var(--bjfu-secondary);
            border-color: var(--bjfu-secondary);
        }

        .pagination-custom .page-item.active .page-link {
            background-color: var(--bjfu-primary);
            border-color: var(--bjfu-primary);
            color: white;
        }

        /* ========== æ¨¡æ€æ¡†æ ·å¼ ========== */
        .modal-header.card-header-park {
            background: var(--bjfu-gradient) !important;
            color: white;
            border-radius: 0;
        }

        .modal-header .btn-close-white {
            filter: invert(1) grayscale(100%) brightness(200%);
        }

        .modal-content {
            border: none;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(10, 94, 56, 0.2);
        }

        /* ========== è¡¨å•æ§ä»¶æ ·å¼ ========== */
        .form-control, .form-select {
            border: 1px solid var(--bjfu-border);
            border-radius: 6px;
            padding: 0.6rem 0.8rem;
            transition: all 0.3s ease;
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--bjfu-primary);
            box-shadow: 0 0 0 0.25rem rgba(10, 94, 56, 0.15);
            outline: none;
        }

        .form-label {
            font-weight: 600;
            color: var(--bjfu-dark);
            margin-bottom: 0.3rem;
        }

        .form-label span.text-danger {
            color: #dc3545;
        }

        /* ========== åŒ—æ—ç‰¹è‰²è£…é¥°å…ƒç´  ========== */
        .bjfu-decoration {
            position: relative;
        }

        .bjfu-decoration::before {
            content: "ğŸŒ¿";
            position: absolute;
            font-size: 1.2rem;
            opacity: 0.3;
        }

        /* ========== é¡µè„šæ ·å¼ ========== */
        footer {
            margin-top: 3rem;
            padding: 1.5rem 0;
            background: var(--bjfu-primary);
            color: white;
            text-align: center;
            font-size: 0.9rem;
            margin-left: 220px;
        }

        /* ========== å“åº”å¼è®¾è®¡ ========== */
        @media (max-width: 768px) {
            .sidebar {
                width: 180px;
            }

            .main-content, footer {
                margin-left: 180px;
            }

            .navbar-brand {
                font-size: 1.2rem;
                padding-left: 35px;
            }

            .card-body {
                padding: 1rem;
            }

            .page-title {
                font-size: 1.5rem;
            }

            .btn-park {
                padding: 0.5rem 1rem;
                font-size: 0.9rem;
            }
        }

        @media (max-width: 576px) {
            .sidebar {
                display: none;
            }

            .main-content, footer {
                margin-left: 0;
                padding: 15px;
            }

            .d-flex.justify-content-between {
                flex-direction: column;
                gap: 1rem;
            }
        }

        /* ========== æ‰“å°æ ·å¼ ========== */
        @media print {
            .btn-park, .navbar, .sidebar, .modal, footer {
                display: none !important;
            }

            .main-content {
                margin-left: 0;
                margin-top: 0;
                padding: 0;
            }

            .card {
                box-shadow: none;
                border: 1px solid #ddd;
            }
        }
    </style>
</head>
<body>
    <!-- é¡¶éƒ¨å¯¼èˆªæ ï¼ˆåŒ—æ—ä¸»é¢˜ï¼‰ -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-success fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="/">ç”Ÿç‰©å¤šæ ·æ€§ç›‘æµ‹ç³»ç»Ÿ</a>
            <div class="navbar-collapse">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="/">é¦–é¡µ</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/species">ç‰©ç§ç®¡ç†</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/monitor">ç›‘æµ‹è®°å½•</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/habitat">æ –æ¯åœ°åˆ†æ</a>
                    </li>
                </ul>
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="logout()"><i class="bi bi-box-arrow-right"></i> é€€å‡ºç™»å½•</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- ä¾§è¾¹æ  -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h4><i class="bi bi-tree me-2"></i>åŠŸèƒ½èœå•</h4>
        </div>
        <ul class="sidebar-menu">
            <li><a href="/"><i class="bi bi-house"></i>é¦–é¡µ</a></li>
            <li><a href="/species" class="active"><i class="bi bi-paw"></i>ç‰©ç§ç®¡ç†</a></li>
            <li><a href="/monitor"><i class="bi bi-journal-text"></i>ç›‘æµ‹è®°å½•</a></li>
            <li><a href="/habitat"><i class="bi bi-map"></i>æ –æ¯åœ°åˆ†æ</a></li>
        </ul>
    </div>

    <!-- ä¸»å†…å®¹åŒº -->
    <div class="main-content">
        <!-- é¡µé¢å¤´éƒ¨ï¼ˆåŒ—æ—ä¸»é¢˜ï¼‰ -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="page-title">ç‰©ç§ä¿¡æ¯ç®¡ç†</h2>
            <button class="btn btn-park" data-bs-toggle="modal" data-bs-target="#addModal">
                <i class="bi bi-plus me-1"></i>æ–°å¢ç‰©ç§
            </button>
        </div>

        <!-- æœç´¢åŒº -->
        <div class="content-card">
            <form id="searchForm" class="row g-3">
                <div class="col-md-4">
                    <label class="form-label fw-medium">ç‰©ç§åç§°</label>
                    <div class="input-group">
                        <span class="input-group-text bg-light"><i class="bi bi-search"></i></span>
                        <input type="text" class="form-control" id="searchName" placeholder="è¯·è¾“å…¥ç‰©ç§åç§°">
                    </div>
                </div>
                <div class="col-md-3">
                    <label class="form-label fw-medium">ä¿æŠ¤çº§åˆ«</label>
                    <select class="form-select" id="searchLevel">
                        <option value="">å…¨éƒ¨çº§åˆ«</option>
                        <option value="å›½å®¶ä¸€çº§">å›½å®¶ä¸€çº§</option>
                        <option value="å›½å®¶äºŒçº§">å›½å®¶äºŒçº§</option>
                        <option value="æ— ">æ— </option>
                    </select>
                </div>
                <div class="col-md-2">
                    <label class="form-label fw-medium">&nbsp;</label>
                    <button type="button" class="btn btn-park w-100" onclick="searchSpecies()">
                        <i class="bi bi-search me-1"></i>æŸ¥è¯¢
                    </button>
                </div>
                <div class="col-md-2">
                    <label class="form-label fw-medium">&nbsp;</label>
                    <button type="button" class="btn btn-outline-secondary w-100" onclick="resetSearch()">
                        <i class="bi bi-arrow-counterclockwise me-1"></i>é‡ç½®
                    </button>
                </div>
            </form>
        </div>

        <!-- æ•°æ®è¡¨æ ¼åŒº -->
        <div class="card shadow-sm">
            <div class="card-body">
                <div class="table-responsive">
                    <table class="data-table">
                        <thead class="table-success">
                            <tr>
                                <th>ç‰©ç§ID</th>
                                <th>ä¸­æ–‡åç§°</th>
                                <th>æ‹‰ä¸å­¦å</th>
                                <th>ä¿æŠ¤çº§åˆ«</th>
                                <th>ç”Ÿå­˜ç¯å¢ƒ</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="speciesTable">
                            <!-- æ•°æ®ç”±JSåŠ¨æ€æ¸²æŸ“ -->
                        </tbody>
                    </table>
                </div>

                <!-- åˆ†é¡µ -->
                <nav class="pagination-custom">
                    <ul class="pagination" id="pagination">
                        <!-- åˆ†é¡µç”±JSåŠ¨æ€æ¸²æŸ“ -->
                    </ul>
                </nav>
            </div>
        </div>
    </div>

    <!-- æ–°å¢ç‰©ç§å¼¹çª—ï¼ˆåŒ—æ—ä¸»é¢˜ï¼‰ -->
    <div class="modal fade" id="addModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header card-header-park">
                    <h5 class="modal-title">æ–°å¢ç‰©ç§ä¿¡æ¯</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addForm" class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label fw-medium">ä¸­æ–‡åç§° <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="addChineseName" required placeholder="å¦‚ï¼šå¤§ç†ŠçŒ«">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-medium">æ‹‰ä¸å­¦å <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="addLatinName" required placeholder="å¦‚ï¼šAiluropoda melanoleuca">
                        </div>
                        <div class="col-md-2">
                            <label class="form-label fw-medium">ç•Œ <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="addKingdom" required placeholder="å¦‚ï¼šåŠ¨ç‰©ç•Œ">
                        </div>
                        <div class="col-md-2">
                            <label class="form-label fw-medium">é—¨ <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="addPhylum" required placeholder="å¦‚ï¼šè„Šç´¢åŠ¨ç‰©é—¨">
                        </div>
                        <div class="col-md-2">
                            <label class="form-label fw-medium">çº² <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="addClass" required placeholder="å¦‚ï¼šå“ºä¹³çº²">
                        </div>
                        <div class="col-md-2">
                            <label class="form-label fw-medium">ç›® <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="addOrder" required placeholder="å¦‚ï¼šé£Ÿè‚‰ç›®">
                        </div>
                        <div class="col-md-2">
                            <label class="form-label fw-medium">ç§‘ <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="addFamily" required placeholder="å¦‚ï¼šç†Šç§‘">
                        </div>
                        <div class="col-md-2">
                            <label class="form-label fw-medium">å± <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="addGenus" required placeholder="å¦‚ï¼šå¤§ç†ŠçŒ«å±">
                        </div>
                        <div class="col-md-3">
                            <label class="form-label fw-medium">ä¿æŠ¤çº§åˆ« <span class="text-danger">*</span></label>
                            <select class="form-select" id="addProtectionLevel" required>
                                <option value="">è¯·é€‰æ‹©</option>
                                <option value="å›½å®¶ä¸€çº§">å›½å®¶ä¸€çº§</option>
                                <option value="å›½å®¶äºŒçº§">å›½å®¶äºŒçº§</option>
                                <option value="æ— ">æ— </option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label fw-medium">ç§ <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="addSpecies" required placeholder="å¦‚ï¼šå¤§ç†ŠçŒ«ç§">
                        </div>
                        <div class="col-md-12">
                            <label class="form-label fw-medium">ç”Ÿå­˜ä¹ æ€§ <span class="text-danger">*</span></label>
                            <textarea class="form-control" id="addLivingHabits" rows="2" required placeholder="å¦‚ï¼šç‹¬å±…ï¼Œå–œé£Ÿç«¹ç±»ï¼Œæ –æ¯äºé«˜å±±ç«¹æ—"></textarea>
                        </div>
                        <div class="col-md-12">
                            <label class="form-label fw-medium">åˆ†å¸ƒåŒºåŸŸ/ç”Ÿå­˜ç¯å¢ƒ <span class="text-danger">*</span></label>
                            <textarea class="form-control" id="addDistribution" rows="2" required placeholder="å¦‚ï¼šå››å·å§é¾™ã€é™•è¥¿ç§¦å²­ã€ç”˜è‚ƒç™½æ°´æ±Ÿ"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å–æ¶ˆ</button>
                    <button type="button" class="btn btn-park" onclick="saveSpecies()">æäº¤</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ç¼–è¾‘ç‰©ç§å¼¹çª—ï¼ˆåŒ—æ—ä¸»é¢˜ï¼‰ -->
    <div class="modal fade" id="editModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header card-header-park">
                    <h5 class="modal-title">ç¼–è¾‘ç‰©ç§ä¿¡æ¯</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="editForm" class="row g-3">
                        <!-- éšè—å­—æ®µå­˜å‚¨ç‰©ç§ID -->
                        <input type="hidden" id="editSpeciesId">
                        <div class="col-md-6">
                            <label class="form-label fw-medium">ä¸­æ–‡åç§° <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="editChineseName" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-medium">æ‹‰ä¸å­¦å <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="editLatinName" required>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label fw-medium">ç•Œ <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="editKingdom" required>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label fw-medium">é—¨ <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="editPhylum" required>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label fw-medium">çº² <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="editClass" required>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label fw-medium">ç›® <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="editOrder" required>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label fw-medium">ç§‘ <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="editFamily" required>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label fw-medium">å± <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="editGenus" required>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label fw-medium">ä¿æŠ¤çº§åˆ« <span class="text-danger">*</span></label>
                            <select class="form-select" id="editProtectionLevel" required>
                                <option value="">è¯·é€‰æ‹©</option>
                                <option value="å›½å®¶ä¸€çº§">å›½å®¶ä¸€çº§</option>
                                <option value="å›½å®¶äºŒçº§">å›½å®¶äºŒçº§</option>
                                <option value="æ— ">æ— </option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label fw-medium">ç§ <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="editSpecies" required>
                        </div>
                        <div class="col-md-12">
                            <label class="form-label fw-medium">ç”Ÿå­˜ä¹ æ€§ <span class="text-danger">*</span></label>
                            <textarea class="form-control" id="editLivingHabits" rows="2" required></textarea>
                        </div>
                        <div class="col-md-12">
                            <label class="form-label fw-medium">åˆ†å¸ƒåŒºåŸŸ/ç”Ÿå­˜ç¯å¢ƒ <span class="text-danger">*</span></label>
                            <textarea class="form-control" id="editDistribution" rows="2" required></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å–æ¶ˆ</button>
                    <button type="button" class="btn btn-park" onclick="updateSpecies()">æ›´æ–°</button>
                </div>
            </div>
        </div>
    </div>

    <!-- é¡µè„š -->
    <footer>
        <div class="container">
            <p>Â© 2025 åŒ—äº¬æ—ä¸šå¤§å­¦ - ç”Ÿç‰©å¤šæ ·æ€§ç›‘æµ‹ç³»ç»Ÿ | ç‰ˆæƒæ‰€æœ‰</p>
        </div>
    </footer>

    <script>
        // å…¨å±€åˆ†é¡µå‚æ•°
        let currentPage = 1;
        const pageSize = 10;
        let totalCount = 0;

        // é€€å‡ºç™»å½•
        function logout() {
            localStorage.removeItem('user');
            alert('å·²é€€å‡ºç™»å½•');
        }

        // é¡µé¢åŠ è½½æ—¶åŠ è½½ç‰©ç§æ•°æ®
        window.onload = function() {
            loadSpeciesData();
        }

        // åŠ è½½ç‰©ç§æ•°æ®ï¼ˆæ ¸å¿ƒï¼‰
        function loadSpeciesData() {
            // è·å–ç­›é€‰æ¡ä»¶
            const keyword = document.getElementById('searchName').value.trim();
            const protectionLevel = document.getElementById('searchLevel').value;

            // æ„å»ºè¯·æ±‚å‚æ•°
            const params = new URLSearchParams({
                page: currentPage,
                size: pageSize,
                keyword: keyword,
                protectionLevel: protectionLevel
            });

            // è°ƒç”¨åç«¯æ¥å£
            fetch(`/api/species?${params}`)
                .then(res => res.json())
                .then(response => {
                    if (response.code === 200) {
                        totalCount = response.total;
                        // æ¸²æŸ“è¡¨æ ¼
                        renderSpeciesTable(response.data);
                        // æ¸²æŸ“åˆ†é¡µ
                        renderPagination();
                    } else {
                        alert(`æ•°æ®åŠ è½½å¤±è´¥ï¼š${response.msg}`);
                    }
                })
                .catch(err => {
                    alert('ç½‘ç»œå¼‚å¸¸ï¼Œæ— æ³•åŠ è½½æ•°æ®ï¼š' + err.message);
                });
        }

        // æ¸²æŸ“ç‰©ç§è¡¨æ ¼
        function renderSpeciesTable(speciesList) {
            const tableBody = document.getElementById('speciesTable');
            tableBody.innerHTML = '';

            if (speciesList.length === 0) {
                const emptyTr = document.createElement('tr');
                emptyTr.innerHTML = `<td colspan="6" class="text-center text-muted py-3">æš‚æ— ç‰©ç§æ•°æ®</td>`;
                tableBody.appendChild(emptyTr);
                return;
            }

            // éå†æ•°æ®ç”Ÿæˆè¡Œ
            speciesList.forEach(item => {
                const tr = document.createElement('tr');
                // ä¿æŠ¤çº§åˆ«å¾½ç« æ ·å¼
                let badgeClass = '';
                if (item.protectionLevel === 'å›½å®¶ä¸€çº§') badgeClass = 'badge-danger-custom';
                else if (item.protectionLevel === 'å›½å®¶äºŒçº§') badgeClass = 'badge-warning-custom';
                else badgeClass = 'badge-success-custom';

                tr.innerHTML = `
                    <td>${item.speciesId}</td>
                    <td>${item.chineseName}</td>
                    <td>${item.latinName}</td>
                    <td><span class="badge ${badgeClass}">${item.protectionLevel}</span></td>
                    <td>${item.distribution || '-'}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary me-1" onclick="openEditModal('${item.speciesId}')">
                            <i class="bi bi-pencil"></i>ç¼–è¾‘
                        </button>
                        <button class="btn btn-sm btn-outline-danger" onclick="deleteSpecies('${item.speciesId}')">
                            <i class="bi bi-trash"></i>åˆ é™¤
                        </button>
                    </td>
                `;
                tableBody.appendChild(tr);
            });
        }

        // æ¸²æŸ“åˆ†é¡µ
        function renderPagination() {
            const pagination = document.getElementById('pagination');
            pagination.innerHTML = '';
            const totalPages = Math.ceil(totalCount / pageSize);

            // ä¸Šä¸€é¡µ
            const prevLi = document.createElement('li');
            prevLi.className = `page-item ${currentPage === 1 ? 'disabled' : ''}`;
            prevLi.innerHTML = `<a class="page-link" href="#" onclick="changePage(${currentPage - 1})">ä¸Šä¸€é¡µ</a>`;
            pagination.appendChild(prevLi);

            // é¡µç ï¼ˆæ˜¾ç¤ºå½“å‰é¡µå‰å2é¡µï¼‰
            const startPage = Math.max(1, currentPage - 2);
            const endPage = Math.min(totalPages, currentPage + 2);
            for (let i = startPage; i <= endPage; i++) {
                const pageLi = document.createElement('li');
                pageLi.className = `page-item ${i === currentPage ? 'active' : ''}`;
                pageLi.innerHTML = `<a class="page-link" href="#" onclick="changePage(${i})">${i}</a>`;
                pagination.appendChild(pageLi);
            }

            // ä¸‹ä¸€é¡µ
            const nextLi = document.createElement('li');
            nextLi.className = `page-item ${currentPage === totalPages ? 'disabled' : ''}`;
            nextLi.innerHTML = `<a class="page-link" href="#" onclick="changePage(${currentPage + 1})">ä¸‹ä¸€é¡µ</a>`;
            pagination.appendChild(nextLi);
        }

        // åˆ‡æ¢åˆ†é¡µ
        function changePage(page) {
            const totalPages = Math.ceil(totalCount / pageSize);
            if (page < 1 || page > totalPages) return;
            currentPage = page;
            loadSpeciesData();
        }

        // æœç´¢ç‰©ç§
        function searchSpecies() {
            currentPage = 1; // æœç´¢åé‡ç½®ä¸ºç¬¬ä¸€é¡µ
            loadSpeciesData();
        }

        // é‡ç½®æœç´¢
        function resetSearch() {
            document.getElementById('searchForm').reset();
            currentPage = 1;
            loadSpeciesData();
        }

        // ä¿å­˜æ–°å¢ç‰©ç§
        function saveSpecies() {
            // è·å–è¡¨å•æ•°æ®
            const formData = {
                chineseName: document.getElementById('addChineseName').value.trim(),
                latinName: document.getElementById('addLatinName').value.trim(),
                kingdom: document.getElementById('addKingdom').value.trim(),
                phylum: document.getElementById('addPhylum').value.trim(),
                class: document.getElementById('addClass').value.trim(),
                order: document.getElementById('addOrder').value.trim(),
                family: document.getElementById('addFamily').value.trim(),
                genus: document.getElementById('addGenus').value.trim(),
                species: document.getElementById('addSpecies').value.trim(),
                protectionLevel: document.getElementById('addProtectionLevel').value,
                livingHabits: document.getElementById('addLivingHabits').value.trim(),
                distribution: document.getElementById('addDistribution').value.trim()
            };

            // è¡¨å•éªŒè¯
            if (!formData.chineseName || !formData.latinName || !formData.kingdom) {
                alert('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µï¼ˆæ ‡*çš„å­—æ®µï¼‰');
                return;
            }

            // è°ƒç”¨æ–°å¢æ¥å£
            fetch('/api/species', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            })
                .then(res => res.json())
                .then(response => {
                    if (response.code === 200) {
                        alert(response.msg);
                        // å…³é—­å¼¹çª—
                        bootstrap.Modal.getInstance(document.getElementById('addModal')).hide();
                        // é‡ç½®è¡¨å•
                        document.getElementById('addForm').reset();
                        // é‡æ–°åŠ è½½æ•°æ®
                        loadSpeciesData();
                    } else {
                        alert(`æ–°å¢å¤±è´¥ï¼š${response.msg}`);
                    }
                })
                .catch(err => {
                    alert('ç½‘ç»œå¼‚å¸¸ï¼Œæ–°å¢å¤±è´¥ï¼š' + err.message);
                });
        }

        // æ‰“å¼€ç¼–è¾‘å¼¹çª—å¹¶åŠ è½½æ•°æ®
        function openEditModal(speciesId) {
            // å…ˆæŸ¥è¯¢è¯¥ç‰©ç§çš„è¯¦æƒ…
            fetch(`/api/species?page=1&size=1&keyword=&protectionLevel=&speciesId=${speciesId}`)
                .then(res => res.json())
                .then(response => {
                    if (response.code === 200 && response.data.length > 0) {
                        const item = response.data[0];
                        // å¡«å……ç¼–è¾‘è¡¨å•
                        document.getElementById('editSpeciesId').value = item.speciesId;
                        document.getElementById('editChineseName').value = item.chineseName;
                        document.getElementById('editLatinName').value = item.latinName;
                        document.getElementById('editKingdom').value = item.kingdom;
                        document.getElementById('editPhylum').value = item.phylum;
                        document.getElementById('editClass').value = item.class;
                        document.getElementById('editOrder').value = item.order;
                        document.getElementById('editFamily').value = item.family;
                        document.getElementById('editGenus').value = item.genus;
                        document.getElementById('editSpecies').value = item.species;
                        document.getElementById('editProtectionLevel').value = item.protectionLevel;
                        document.getElementById('editLivingHabits').value = item.livingHabits;
                        document.getElementById('editDistribution').value = item.distribution;

                        // æ‰“å¼€å¼¹çª—
                        const editModal = new bootstrap.Modal(document.getElementById('editModal'));
                        editModal.show();
                    } else {
                        alert('è·å–ç‰©ç§è¯¦æƒ…å¤±è´¥');
                    }
                })
                .catch(err => {
                    alert('ç½‘ç»œå¼‚å¸¸ï¼Œæ— æ³•è·å–ç‰©ç§è¯¦æƒ…ï¼š' + err.message);
                });
        }

        // æ›´æ–°ç‰©ç§ä¿¡æ¯
        function updateSpecies() {
            // è·å–è¡¨å•æ•°æ®
            const speciesId = document.getElementById('editSpeciesId').value;
            const formData = {
                chineseName: document.getElementById('editChineseName').value.trim(),
                latinName: document.getElementById('editLatinName').value.trim(),
                kingdom: document.getElementById('editKingdom').value.trim(),
                phylum: document.getElementById('editPhylum').value.trim(),
                class: document.getElementById('editClass').value.trim(),
                order: document.getElementById('editOrder').value.trim(),
                family: document.getElementById('editFamily').value.trim(),
                genus: document.getElementById('editGenus').value.trim(),
                species: document.getElementById('editSpecies').value.trim(),
                protectionLevel: document.getElementById('editProtectionLevel').value,
                livingHabits: document.getElementById('editLivingHabits').value.trim(),
                distribution: document.getElementById('editDistribution').value.trim()
            };

            // è¡¨å•éªŒè¯
            if (!formData.chineseName || !formData.latinName || !formData.kingdom) {
                alert('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µï¼ˆæ ‡*çš„å­—æ®µï¼‰');
                return;
            }

            // è°ƒç”¨æ›´æ–°æ¥å£
            fetch(`/api/species/${speciesId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            })
                .then(res => res.json())
                .then(response => {
                    if (response.code === 200) {
                        alert(response.msg);
                        // å…³é—­å¼¹çª—
                        bootstrap.Modal.getInstance(document.getElementById('editModal')).hide();
                        // é‡æ–°åŠ è½½æ•°æ®
                        loadSpeciesData();
                    } else {
                        alert(`æ›´æ–°å¤±è´¥ï¼š${response.msg}`);
                    }
                })
                .catch(err => {
                    alert('ç½‘ç»œå¼‚å¸¸ï¼Œæ›´æ–°å¤±è´¥ï¼š' + err.message);
                });
        }

        // åˆ é™¤ç‰©ç§
        function deleteSpecies(speciesId) {
            if (!confirm(`ç¡®å®šè¦åˆ é™¤ç‰©ç§ã€${speciesId}ã€‘å—ï¼Ÿåˆ é™¤åä¸å¯æ¢å¤ï¼`)) {
                return;
            }

            // è°ƒç”¨åˆ é™¤æ¥å£
            fetch(`/api/species/${speciesId}`, {
                method: 'DELETE'
            })
                .then(res => res.json())
                .then(response => {
                    if (response.code === 200) {
                        alert(response.msg);
                        // é‡æ–°åŠ è½½æ•°æ®
                        loadSpeciesData();
                    } else {
                        alert(`åˆ é™¤å¤±è´¥ï¼š${response.msg}`);
                    }
                })
                .catch(err => {
                    alert('ç½‘ç»œå¼‚å¸¸ï¼Œåˆ é™¤å¤±è´¥ï¼š' + err.message);
                });
        }
    </script>
</body>
</html>